
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Spirit World Hunter - By Anupam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            max-width: 100vw;
            max-height: 100vh;
            background: #111;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        .menu h1 {
            font-size: 48px;
            color: #ff6b6b;
            text-shadow: 0 0 20px #ff6b6b;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .menu h2 {
            font-size: 24px;
            color: #4ecdc4;
            margin-bottom: 40px;
        }
        
        .menu button {
            background: #4ecdc4;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .menu button:hover {
            background: #45b7b8;
            transform: scale(1.1);
            box-shadow: 0 0 20px #4ecdc4;
        }
        
        .menu input {
            background: #222;
            color: #fff;
            border: 2px solid #4ecdc4;
            padding: 10px;
            font-size: 18px;
            margin: 10px;
            border-radius: 5px;
        }
        
        .hidden {
            display: none !important;
        }
        
        #stats {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        #healthBar {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 20px;
            background: #333;
            border: 2px solid #fff;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #healthFill {
            height: 100%;
            background: #ff6b6b;
            transition: width 0.3s;
        }
        
        #levelProgress {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 300px;
            height: 20px;
            background: #333;
            border: 2px solid #fff;
            border-radius: 10px;
            overflow: hidden;
        }
        
        #levelFill {
            height: 100%;
            background: #4ecdc4;
            transition: width 0.3s;
        }
        
        .touch-controls {
            position: absolute;
            bottom: 40px;
            right: 10px;
            display: none;
        }
        
        .touch-controls button {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid #fff;
            border-radius: 50%;
            color: #fff;
            font-size: 24px;
            margin: 5px;
            cursor: pointer;
        }
        
        @media (max-width: 800px) {
            .touch-controls {
                display: block;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        #achievement {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 20px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            display: none;
            z-index: 20;
        }
        
        #dialogue {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            display: none;
            z-index: 15;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <!-- Main Menu -->
        <div id="mainMenu" class="menu">
            <h1>Spirit World Hunter</h1>
            <h2>By Anupam</h2>
            <button onclick="showIntro()">Start Game</button>
            <button onclick="showCharacterSelect()">Select Character</button>
            <button onclick="showStats()">Stats</button>
            <button onclick="showAchievements()">Achievements</button>
        </div>
        
        <!-- Intro Cutscene -->
        <div id="introMenu" class="menu hidden">
            <h1>Welcome to Spirit World</h1>
            <div id="spiritGuide" style="width: 100px; height: 100px; background: #4ecdc4; border-radius: 50%; margin: 20px;"></div>
            <p id="introText" style="font-size: 20px; text-align: center; margin: 20px;"></p>
            <input type="text" id="playerName" placeholder="Enter your name" maxlength="20">
            <button onclick="startGame()">Continue</button>
        </div>
        
        <!-- Character Select -->
        <div id="characterMenu" class="menu hidden">
            <h1>Select Character</h1>
            <div id="characterGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px;">
                <!-- Characters will be populated here -->
            </div>
            <button onclick="backToMenu()">Back</button>
        </div>
        
        <!-- Stats Menu -->
        <div id="statsMenu" class="menu hidden">
            <h1>Player Stats</h1>
            <div id="statsContent" style="font-size: 18px; text-align: center; margin: 20px;"></div>
            <button onclick="backToMenu()">Back</button>
        </div>
        
        <!-- Achievements Menu -->
        <div id="achievementsMenu" class="menu hidden">
            <h1>Achievements</h1>
            <div id="achievementsList" style="max-height: 400px; overflow-y: auto; margin: 20px;"></div>
            <button onclick="backToMenu()">Back</button>
        </div>
        
        <!-- Game UI -->
        <div id="gameStats" class="hidden">
            <div id="stats"></div>
            <div id="healthBar">
                <div id="healthFill" style="width: 100%;"></div>
            </div>
            <div id="levelProgress">
                <div id="levelFill" style="width: 0%;"></div>
            </div>
        </div>
        
        <!-- Touch Controls -->
        <div class="touch-controls">
            <button ontouchstart="movePlayer('up')" ontouchend="stopMove('up')">↑</button>
            <button ontouchstart="movePlayer('left')" ontouchend="stopMove('left')">←</button>
            <button ontouchstart="movePlayer('down')" ontouchend="stopMove('down')">↓</button>
            <button ontouchstart="movePlayer('right')" ontouchend="stopMove('right')">→</button>
            <button ontouchstart="useWeapon()">⚔</button>
        </div>
        
        <!-- Achievement Popup -->
        <div id="achievement"></div>
        
        <!-- Dialogue Box -->
        <div id="dialogue"></div>
    </div>

    <script>
        // Game Variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameContainer = document.getElementById('gameContainer');
        
        // Game State
        let gameState = 'menu';
        let currentLevel = 1;
        let player = null;
        let ghosts = [];
        let projectiles = [];
        let particles = [];
        let keys = {};
        let touchKeys = {};
        let gameData = {
            playerName: '',
            coins: 0,
            stars: 0,
            xp: 0,
            unlockedCharacters: [0],
            unlockedSkills: [0],
            unlockedWeapons: [0],
            achievements: [],
            totalGhostsCaught: 0,
            highestLevel: 1
        };
        
        // Audio Context
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Characters
        const characters = [
            { name: 'Male Hunter', color: '#4ecdc4', unlocked: true },
            { name: 'Female Hunter', color: '#ff6b6b', unlocked: false },
            { name: 'Elder Sage', color: '#95e1d3', unlocked: false },
            { name: 'Teenage Boy', color: '#f38181', unlocked: false }
        ];
        
        // Skills
        const skills = [
            { name: 'Basic Ghost Trap', unlocked: true },
            { name: 'Ghost Radar', cost: 50, unlocked: false },
            { name: 'Speed Boost', cost: 100, unlocked: false },
            { name: 'Damage Shield', cost: 150, unlocked: false },
            { name: 'Super Trap', cost: 200, unlocked: false }
        ];
        
        // Weapons
        const weapons = [
            { name: 'Ghost Net', damage: 10, speed: 5, unlocked: true },
            { name: 'Electric Trap', damage: 15, speed: 6, cost: 75, unlocked: false },
            { name: 'Holy Water', damage: 20, speed: 4, cost: 125, unlocked: false },
            { name: 'Spirit Gun', damage: 25, speed: 8, cost: 175, unlocked: false },
            { name: 'Ghost Bomb', damage: 30, speed: 3, cost: 225, unlocked: false },
            { name: 'Ultimate Exorcist Blade', damage: 50, speed: 10, cost: 300, unlocked: false }
        ];
        
        // Levels
        const levels = [
            { name: 'Haunted House', bg: '#2c3e50', ghostCount: 5 },
            { name: 'Graveyard', bg: '#34495e', ghostCount: 7 },
            { name: 'Dark Forest', bg: '#1a252f', ghostCount: 9 },
            { name: 'Mansion Entrance', bg: '#2c3e50', ghostCount: 11 },
            { name: 'Mansion Hall', bg: '#34495e', ghostCount: 13 },
            { name: 'Mansion Library', bg: '#1a252f', ghostCount: 15 },
            { name: 'Mansion Bedroom', bg: '#2c3e50', ghostCount: 17 },
            { name: 'Mansion Basement', bg: '#34495e', ghostCount: 19 },
            { name: 'Spirit Realm', bg: '#4a235a', ghostCount: 21 },
            { name: 'Ghost King Palace', bg: '#6c3483', ghostCount: 23 },
            { name: 'Cursed Temple', bg: '#7b3f00', ghostCount: 25 },
            { name: 'Vampire Castle', bg: '#4a0000', ghostCount: 27 },
            { name: 'Witch Tower', bg: '#2e4057', ghostCount: 29 },
            { name: 'Zombie Crypt', bg: '#2c1810', ghostCount: 31 },
            { name: 'Demon Pit', bg: '#8b0000', ghostCount: 33 },
            { name: 'Phoenix Nest', bg: '#ff6b35', ghostCount: 35 },
            { name: 'Dragon Cave', bg: '#1a535c', ghostCount: 37 },
            { name: 'Underworld Gate', bg: '#2d132c', ghostCount: 39 },
            { name: 'Final Battle', bg: '#000000', ghostCount: 50 },
            { name: 'Victory', bg: '#ffd700', ghostCount: 0 }
        ];
        
        // Achievements
        const achievements = [
            { id: 'firstGhost', name: 'First Catch', description: 'Catch your first ghost', reward: 10 },
            { id: 'tenGhosts', name: 'Ghost Hunter', description: 'Catch 10 ghosts in 1 minute', reward: 25 },
            { id: 'noDamage', name: 'Untouchable', description: 'Complete level without damage', reward: 50 },
            { id: 'fiveLevels', name: 'Experienced Hunter', description: 'Complete 5 levels', reward: 75 },
            { id: 'allWeapons', name: 'Arsenal Master', description: 'Unlock all weapons', reward: 100 },
            { id: 'allSkills', name: 'Skill Master', description: 'Unlock all skills', reward: 100 },
            { id: 'allCharacters', name: 'Character Collector', description: 'Unlock all characters', reward: 100 },
            { id: 'gameComplete', name: 'Spirit World Master', description: 'Complete all 20 levels', reward: 500 }
        ];
        
        // Player Class
        class Player {
            constructor(x, y, characterIndex) {
                this.x = x;
                this.y = y;
                this.width = 40;
                this.height = 40;
                this.speed = 3;
                this.health = 100;
                this.maxHealth = 100;
                this.characterIndex = characterIndex;
                this.color = characters[characterIndex].color;
                this.weaponIndex = 0;
                this.facing = 'right';
                this.invulnerable = false;
                this.invulnerableTime = 0;
                this.speedBoost = false;
                this.shield = false;
            }
            
            update() {
                // Movement
                if (keys['ArrowLeft'] || keys['a'] || touchKeys['left']) {
                    this.x -= this.speed;
                    this.facing = 'left';
                }
                if (keys['ArrowRight'] || keys['d'] || touchKeys['right']) {
                    this.x += this.speed;
                    this.facing = 'right';
                }
                if (keys['ArrowUp'] || keys['w'] || touchKeys['up']) {
                    this.y -= this.speed;
                }
                if (keys['ArrowDown'] || keys['s'] || touchKeys['down']) {
                    this.y += this.speed;
                }
                
                // Boundaries
                this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
                this.y = Math.max(0, Math.min(canvas.height - this.height, this.y));
                
                // Update invulnerability
                if (this.invulnerable) {
                    this.invulnerableTime--;
                    if (this.invulnerableTime <= 0) {
                        this.invulnerable = false;
                    }
                }
                
                // Update speed boost
                if (this.speedBoost) {
                    this.speed = 5;
                } else {
                    this.speed = 3;
                }
            }
            
            draw() {
                ctx.save();
                
                // Flash when invulnerable
                if (this.invulnerable && Math.floor(this.invulnerableTime / 5) % 2 === 0) {
                    ctx.globalAlpha = 0.5;
                }
                
                // Draw player
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // Draw face
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x + 10, this.y + 10, 5, 5);
                ctx.fillRect(this.x + 25, this.y + 10, 5, 5);
                ctx.fillRect(this.x + 15, this.y + 25, 10, 3);
                
                // Draw shield if active
                if (this.shield) {
                    ctx.strokeStyle = '#4ecdc4';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(this.x - 5, this.y - 5, this.width + 10, this.height + 10);
                }
                
                ctx.restore();
            }
            
            takeDamage(damage) {
                if (!this.invulnerable && !this.shield) {
                    this.health -= damage;
                    this.invulnerable = true;
                    this.invulnerableTime = 60;
                    playSound('damage');
                    shakeScreen();
                    updateHealthBar();
                    
                    if (this.health <= 0) {
                        gameOver();
                    }
                }
            }
        }
        
        // Ghost Class
        class Ghost {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 30;
                this.speed = 1 + Math.random() * 2;
                this.health = 20;
                this.color = `hsl(${Math.random() * 60 + 200}, 70%, 50%)`;
                this.shootCooldown = 0;
                this.direction = Math.random() * Math.PI * 2;
            }
            
            update() {
                // Move towards player
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 100) {
                    this.x += (dx / distance) * this.speed;
                    this.y += (dy / distance) * this.speed;
                }
                
                // Shoot at player
                this.shootCooldown--;
                if (this.shootCooldown <= 0 && distance < 300) {
                    this.shoot();
                    this.shootCooldown = 120;
                }
            }
            
            shoot() {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                projectiles.push(new Projectile(
                    this.x + this.width / 2,
                    this.y + this.height / 2,
                    (dx / distance) * 3,
                    (dy / distance) * 3,
                    'ghost',
                    10
                ));
            }
            
            draw() {
                ctx.save();
                ctx.fillStyle = this.color;
                ctx.globalAlpha = 0.8;
                
                // Ghost body
                ctx.beginPath();
                ctx.arc(this.x + this.width / 2, this.y + this.height / 2, this.width / 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Ghost tail
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.height);
                for (let i = 0; i < 4; i++) {
                    ctx.lineTo(this.x + (i + 1) * this.width / 4, this.y + this.height + Math.sin(Date.now() / 100 + i) * 5);
                }
                ctx.lineTo(this.x + this.width, this.y + this.height);
                ctx.fill();
                
                // Eyes
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x + 8, this.y + 10, 4, 4);
                ctx.fillRect(this.x + 18, this.y + 10, 4, 4);
                
                ctx.restore();
            }
            
            takeDamage(damage) {
                this.health -= damage;
                if (this.health <= 0) {
                    createParticles(this.x + this.width / 2, this.y + this.height / 2, this.color);
                    gameData.coins += 5;
                    gameData.xp += 10;
                    gameData.totalGhostsCaught++;
                    updateStats();
                    checkAchievements();
                    playSound('catch');
                    
                    // Random chance for star
                    if (Math.random() < 0.1) {
                        gameData.stars++;
                        showAchievement('Star Earned!');
                    }
                    
                    return true;
                }
                return false;
            }
        }
        
        // Projectile Class
        class Projectile {
            constructor(x, y, vx, vy, type, damage) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.type = type;
                this.damage = damage;
                this.radius = 5;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
            }
            
            draw() {
                ctx.save();
                if (this.type === 'weapon') {
                    ctx.fillStyle = '#ffd700';
                } else {
                    ctx.fillStyle = '#ff0000';
                }
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
            
            isOffScreen() {
                return this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height;
            }
        }
        
        // Particle Class
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 5;
                this.vy = (Math.random() - 0.5) * 5;
                this.color = color;
                this.life = 30;
                this.radius = Math.random() * 3 + 1;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.life--;
            }
            
            draw() {
                ctx.save();
                ctx.globalAlpha = this.life / 30;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // Audio Functions
        function playSound(type) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'catch':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'damage':
                    oscillator.frequency.value = 100;
                    gainNode.gain.value = 0.2;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'shoot':
                    oscillator.frequency.value = 400;
                    gainNode.gain.value = 0.05;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.05);
                    break;
                case 'levelComplete':
                    oscillator.frequency.value = 600;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'unlock':
                    oscillator.frequency.value = 1000;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
            }
        }
        
        // Background Music
        function playBackgroundMusic() {
            // Simple background music using Web Audio API
            const notes = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25];
            let currentNote = 0;
            
            setInterval(() => {
                if (gameState === 'playing') {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = notes[currentNote];
                    gainNode.gain.value = 0.02;
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                    
                    currentNote = (currentNote + 1) % notes.length;
                }
            }, 200);
        }
        
        // Game Functions
        function init() {
            loadGameData();
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            window.addEventListener('keydown', (e) => keys[e.key] = true);
            window.addEventListener('keyup', (e) => keys[e.key] = false);
            canvas.addEventListener('click', useWeapon);
            
            // Start background music
            playBackgroundMusic();
            
            gameLoop();
        }
        
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const scale = Math.min(window.innerWidth / 800, window.innerHeight / 600);
            canvas.style.width = (800 * scale) + 'px';
            canvas.style.height = (600 * scale) + 'px';
        }
        
        function gameLoop() {
            if (gameState === 'playing') {
                update();
                draw();
            }
            requestAnimationFrame(gameLoop);
        }
        
        function update() {
            player.update();
            
            // Update ghosts
            for (let i = ghosts.length - 1; i >= 0; i--) {
                ghosts[i].update();
            }
            
            // Update projectiles
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const projectile = projectiles[i];
                projectile.update();
                
                if (projectile.isOffScreen()) {
                    projectiles.splice(i, 1);
                    continue;
                }
                
                // Check collision with player
                if (projectile.type === 'ghost' && checkCollision(projectile, player)) {
                    player.takeDamage(projectile.damage);
                    projectiles.splice(i, 1);
                    continue;
                }
                
                // Check collision with ghosts
                if (projectile.type === 'weapon') {
                    for (let j = ghosts.length - 1; j >= 0; j--) {
                        if (checkCollision(projectile, ghosts[j])) {
                            if (ghosts[j].takeDamage(projectile.damage)) {
                                ghosts.splice(j, 1);
                            }
                            projectiles.splice(i, 1);
                            break;
                        }
                    }
                }
            }
            
            // Update particles
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            // Check level complete
            if (ghosts.length === 0 && currentLevel <= 20) {
                levelComplete();
            }
            
            // Update level progress
            const level = levels[currentLevel - 1];
            const progress = Math.max(0, (level.ghostCount - ghosts.length) / level.ghostCount) * 100;
            document.getElementById('levelFill').style.width = progress + '%';
        }
        
        function draw() {
            // Clear canvas
            ctx.fillStyle = levels[currentLevel - 1].bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid pattern for tilemap effect
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            for (let x = 0; x < canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw player
            player.draw();
            
            // Draw ghosts
            ghosts.forEach(ghost => ghost.draw());
            
            // Draw projectiles
            projectiles.forEach(projectile => projectile.draw());
            
            // Draw particles
            particles.forEach(particle => particle.draw());
        }
        
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + (obj1.width || obj1.radius * 2) > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + (obj1.height || obj1.radius * 2) > obj2.y;
        }
        
        function createParticles(x, y, color) {
            for (let i = 0; i < 10; i++) {
                particles.push(new Particle(x, y, color));
            }
        }
        
        function useWeapon() {
            if (gameState !== 'playing') return;
            
            const weapon = weapons[player.weaponIndex];
            const angle = player.facing === 'right' ? 0 : Math.PI;
            const vx = Math.cos(angle) * weapon.speed;
            const vy = Math.sin(angle) * weapon.speed;
            
            projectiles.push(new Projectile(
                player.x + player.width / 2,
                player.y + player.height / 2,
                vx,
                vy,
                'weapon',
                weapon.damage
            ));
            
            playSound('shoot');
        }
        
        function startLevel() {
            const level = levels[currentLevel - 1];
            ghosts = [];
            projectiles = [];
            particles = [];
            
            // Spawn ghosts
            for (let i = 0; i < level.ghostCount; i++) {
                const x = Math.random() * (canvas.width - 30);
                const y = Math.random() * (canvas.height - 30);
                ghosts.push(new Ghost(x, y));
            }
            
            // Reset player position
            player.x = canvas.width / 2 - player.width / 2;
            player.y = canvas.height / 2 - player.height / 2;
            player.health = player.maxHealth;
            updateHealthBar();
            
            // Show level name
            showDialogue(`Level ${currentLevel}: ${level.name}`);
            
            // Show random Hindi dialogue
            const hindiDialogues = [
                'Bhoot pakdo bhai!',
                'Chalo shuru karo!',
                'Dhyan se! Bhoot aa rahe hain!',
                'Shabaash! Aage badho!',
                'Jeet ke jao!'
            ];
            setTimeout(() => {
                showDialogue(hindiDialogues[Math.floor(Math.random() * hindiDialogues.length)]);
            }, 2000);
        }
        
        function levelComplete() {
            playSound('levelComplete');
            gameData.coins += 20;
            gameData.xp += 50;
            gameData.highestLevel = Math.max(gameData.highestLevel, currentLevel + 1);
            
            if (currentLevel < 20) {
                currentLevel++;
                setTimeout(() => startLevel(), 2000);
                showDialogue('Level Complete! Next level loading...');
            } else {
                gameComplete();
            }
            
            saveGameData();
            updateStats();
            checkAchievements();
        }
        
        function gameComplete() {
            gameState = 'complete';
            showDialogue('Congratulations! You have completed all levels!');
            showAchievement('Game Complete!');
            gameData.achievements.push('gameComplete');
            
            setTimeout(() => {
                document.getElementById('mainMenu').classList.remove('hidden');
                document.getElementById('gameStats').classList.add('hidden');
                gameState = 'menu';
            }, 5000);
        }
        
        function gameOver() {
            gameState = 'gameover';
            showDialogue('Game Over! Try again!');
            
            setTimeout(() => {
                document.getElementById('mainMenu').classList.remove('hidden');
                document.getElementById('gameStats').classList.add('hidden');
                gameState = 'menu';
            }, 3000);
        }
        
        function shakeScreen() {
            gameContainer.classList.add('shake');
            setTimeout(() => gameContainer.classList.remove('shake'), 500);
            
            // Vibrate on mobile if supported
            if (navigator.vibrate) {
                navigator.vibrate(200);
            }
        }
        
        function updateHealthBar() {
            const healthPercent = (player.health / player.maxHealth) * 100;
            document.getElementById('healthFill').style.width = healthPercent + '%';
        }
        
        function updateStats() {
            document.getElementById('stats').innerHTML = `
                Level: ${currentLevel}<br>
                Coins: ${gameData.coins}<br>
                Stars: ${gameData.stars}<br>
                XP: ${gameData.xp}
            `;
        }
        
        function showDialogue(text) {
            const dialogue = document.getElementById('dialogue');
            dialogue.textContent = text;
            dialogue.style.display = 'block';
            setTimeout(() => dialogue.style.display = 'none', 3000);
        }
        
        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            achievement.textContent = text;
            achievement.style.display = 'block';
            playSound('unlock');
            setTimeout(() => achievement.style.display = 'none', 2000);
        }
        
        function checkAchievements() {
            // First ghost
            if (gameData.totalGhostsCaught >= 1 && !gameData.achievements.includes('firstGhost')) {
                gameData.achievements.push('firstGhost');
                gameData.coins += 10;
                showAchievement('First Catch!');
            }
            
            // Ten ghosts in one minute (simplified)
            if (gameData.totalGhostsCaught >= 10 && !gameData.achievements.includes('tenGhosts')) {
                gameData.achievements.push('tenGhosts');
                gameData.coins += 25;
                showAchievement('Ghost Hunter!');
            }
            
            // Five levels
            if (gameData.highestLevel >= 6 && !gameData.achievements.includes('fiveLevels')) {
                gameData.achievements.push('fiveLevels');
                gameData.coins += 75;
                showAchievement('Experienced Hunter!');
            }
        }
        
        // Menu Functions
        function showIntro() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('introMenu').classList.remove('hidden');
            
            // Animate spirit guide
            let textIndex = 0;
            const introTexts = [
                'Namaste dost! Main hoon Spirit Guide.',
                'Spirit world mein welcome!',
                'Apna naam batao.'
            ];
            
            const textElement = document.getElementById('introText');
            textElement.textContent = introTexts[textIndex];
            
            const spiritGuide = document.getElementById('spiritGuide');
            let scale = 1;
            let growing = true;
            
            const animateSpirit = setInterval(() => {
                if (growing) {
                    scale += 0.01;
                    if (scale >= 1.2) growing = false;
                } else {
                    scale -= 0.01;
                    if (scale <= 0.8) growing = true;
                }
                spiritGuide.style.transform = `scale(${scale})`;
            }, 50);
            
            // Change text
            const changeText = setInterval(() => {
                textIndex++;
                if (textIndex < introTexts.length) {
                    textElement.textContent = introTexts[textIndex];
                } else {
                    clearInterval(changeText);
                    clearInterval(animateSpirit);
                }
            }, 3000);
        }
        
        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('Please enter your name!');
                return;
            }
            
            gameData.playerName = playerName;
            saveGameData();
            
            // Send to mock server
            fetch('https://jsonplaceholder.typicode.com/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: playerName,
                    ghostsCaught: gameData.totalGhostsCaught,
                    level: gameData.highestLevel
                })
            });
            
            document.getElementById('introMenu').classList.add('hidden');
            document.getElementById('gameStats').classList.remove('hidden');
            
            // Initialize player
            player = new Player(canvas.width / 2, canvas.height / 2, 0);
            
            gameState = 'playing';
            currentLevel = 1;
            startLevel();
            updateStats();
        }
        
        function showCharacterSelect() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('characterMenu').classList.remove('hidden');
            
            const grid = document.getElementById('characterGrid');
            grid.innerHTML = '';
            
            characters.forEach((char, index) => {
                const div = document.createElement('div');
                div.style.textAlign = 'center';
                div.innerHTML = `
                    <div style="width: 80px; height: 80px; background: ${char.color}; margin: 0 auto 10px; border-radius: 10px;"></div>
                    <p>${char.name}</p>
                    ${char.unlocked ? '<button onclick="selectCharacter(' + index + ')">Select</button>' : '<p>Locked</p>'}
                `;
                grid.appendChild(div);
            });
        }
        
        function selectCharacter(index) {
            if (player) {
                player.characterIndex = index;
                player.color = characters[index].color;
            }
            backToMenu();
        }
        
        function showStats() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('statsMenu').classList.remove('hidden');
            
            const content = document.getElementById('statsContent');
            content.innerHTML = `
                <p>Total players: 1247</p>
                <p>Your rank: #45</p>
                <p>Ghosts caught: ${gameData.totalGhostsCaught}</p>
                <p>Coins: ${gameData.coins}</p>
                <p>Stars: ${gameData.stars}</p>
                <p>XP: ${gameData.xp}</p>
                <p>Highest Level: ${gameData.highestLevel}</p>
            `;
        }
        
        function showAchievements() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('achievementsMenu').classList.remove('hidden');
            
            const list = document.getElementById('achievementsList');
            list.innerHTML = '';
            
            achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.style.marginBottom = '15px';
                div.style.padding = '10px';
                div.style.background = gameData.achievements.includes(achievement.id) ? 'rgba(255, 215, 0, 0.2)' : 'rgba(255, 255, 255, 0.1)';
                div.innerHTML = `
                    <h3>${achievement.name} ${gameData.achievements.includes(achievement.id) ? '✓' : ''}</h3>
                    <p>${achievement.description}</p>
                    <p>Reward: ${achievement.reward} coins</p>
                `;
                list.appendChild(div);
            });
        }
        
        function backToMenu() {
            document.querySelectorAll('.menu').forEach(menu => menu.classList.add('hidden'));
            document.getElementById('mainMenu').classList.remove('hidden');
        }
        
        // Touch Controls
        function movePlayer(direction) {
            touchKeys[direction] = true;
        }
        
        function stopMove(direction) {
            touchKeys[direction] = false;
        }
        
        // Save/Load Functions
        function saveGameData() {
            localStorage.setItem('spiritWorldHunter', JSON.stringify(gameData));
        }
        
        function loadGameData() {
            const saved = localStorage.getItem('spiritWorldHunter');
            if (saved) {
                gameData = JSON.parse(saved);
            }
        }
        
        // Initialize game
        init();
    </script>
</body>
</html>
